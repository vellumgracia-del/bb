<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BARBAR ‚Äî Platform Belajar Masa Depan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Bagian CSS dimulai di sini -->
  <style>
    /* =========================================
    * DESAIN BARU V2 - BARBAR
    * TEMA: EKSOTIS & MODERN (DARK MODE)
    * DENGAN PENYEMPURNAAN RESPONSIVE & UX
    * ========================================= */

    /* -- 1. Variabel & Pengaturan Dasar -- */
    :root {
      --primary-bg: #0F0F1A;
      --secondary-bg: #1B1B2B;
      --accent: #7F5AF0;
      --accent-secondary: #2CB67D;
      --text-primary: #FFFFFE;
      --text-secondary: #94A1B2;
      --border-color: rgba(127, 90, 240, 0.2);
      --shadow-color: rgba(0, 0, 0, 0.2);
      --header-height: 64px;
      --green: #2CB67D;
      --red: #EF4444;
      --yellow: #FBBF24;
      --sidebar-width: 280px; /* Variabel untuk lebar sidebar */

      font-family: 'Manrope', system-ui, sans-serif;
      font-synthesis: none;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    @keyframes slow-pulse {
      0%, 100% { transform: scale(1); opacity: 0.1; }
      50% { transform: scale(1.5); opacity: 0.2; }
    }

    body {
      background-color: var(--primary-bg);
      color: var(--text-primary);
      padding-top: var(--header-height);
      overflow-x: hidden;
      position: relative;
    }
    
    /* Splash Screen Styling */
    .splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--primary-bg);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
        transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
    }
    .splash-screen.hidden {
        opacity: 0;
        visibility: hidden;
    }
    .splash-logo {
        display: flex;
        align-items: center;
        gap: 16px;
        animation: splash-fade-in 1s ease-out;
    }
    .splash-logo h1 { font-size: 48px; }
    @keyframes splash-fade-in {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }


    /* Floating Shapes Background */
    body::before, body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      background: var(--accent);
      filter: blur(150px);
      z-index: -1;
      animation: slow-pulse 20s infinite ease-in-out;
    }
    body::before {
      width: 300px; height: 300px; top: -100px; left: -100px;
    }
    body::after {
      width: 400px; height: 400px; bottom: -150px; right: -150px;
      animation-delay: 5s;
    }

    /* -- 2. Layout & Halaman -- */
    .page-container { 
        width: 100%; 
        /* PERBAIKAN: Tambahkan transisi untuk 'push' layout */
        transition: padding-left 0.4s cubic-bezier(0.22, 1, 0.36, 1);
    }
    .page {
      display: none;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
      animation: fadeIn 0.5s ease-out;
    }
    .page.active { display: block; }
    .page-subtitle { color: var(--text-secondary); margin-top: 4px; max-width: 600px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .container-app {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 24px;
    }
    .left, .sidebar { display: flex; flex-direction: column; gap: 24px; }

    /* -- 3. Header & Navigasi (Sidebar) -- */
    .app-header {
      position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
      background: rgba(15, 15, 26, 0.8);
      backdrop-filter: blur(10px);
      z-index: 100; padding: 0 24px; display: flex; align-items: center;
      border-bottom: 1px solid var(--border-color);
      /* PERBAIKAN: Tambahkan transisi untuk 'push' layout */
      transition: padding-left 0.4s cubic-bezier(0.22, 1, 0.36, 1);
    }
    .header-content {
      width: 100%; max-width: 1200px; margin: 0 auto;
      display: flex; justify-content: space-between; align-items: center;
    }
    .header-left, .header-title-group { display: flex; align-items: center; gap: 16px; }
    h1 { font-size: 22px; font-weight: 800; color: var(--text-primary); }

    .hamburger-btn {
      background: none; border: none; cursor: pointer; padding: 8px; z-index: 110;
      display: flex; flex-direction: column; gap: 5px;
    }
    .hamburger-btn span {
      display: block; width: 24px; height: 2px; background-color: var(--text-primary);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* Sidebar dengan Animasi Baru */
    .sidebar-nav {
      position: fixed; top: 0; left: 0; width: var(--sidebar-width); height: 100%;
      background: var(--secondary-bg);
      box-shadow: 4px 0 20px var(--shadow-color);
      transform: translateX(-100%);
      transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1); /* Easing lebih halus */
      z-index: 105; padding: calc(var(--header-height) + 24px) 24px 24px;
      display: flex; flex-direction: column; gap: 8px;
      border-right: 1px solid var(--border-color);
    }
    .sidebar-nav.open { transform: translateX(0); }
    .sidebar-nav.open .nav-link {
        transform: translateX(0);
        opacity: 1;
        transition-timing-function: cubic-bezier(0.22, 1, 0.36, 1);
    }
    
    .welcome-user {
      padding-bottom: 16px; margin-bottom: 16px; border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
    }
    .nav-link {
      padding: 12px 16px; text-decoration: none; color: var(--text-secondary);
      font-weight: 500; border-radius: 8px; 
      display: flex; align-items: center; gap: 12px;
      /* Animasi staggered untuk link */
      transform: translateX(-20px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s, background-color 0.2s, color 0.2s;
    }
    /* Staggered delay */
    .nav-link:nth-child(2) { transition-delay: 0.05s; }
    .nav-link:nth-child(3) { transition-delay: 0.1s; }
    .nav-link:nth-child(4) { transition-delay: 0.15s; }
    .nav-link:nth-child(5) { transition-delay: 0.2s; }
    .nav-link:nth-child(6) { transition-delay: 0.25s; }

    .nav-link:hover { background-color: var(--primary-bg); color: var(--text-primary); }
    .nav-link.active { background-color: var(--accent); color: white; font-weight: 600; }

    /* Overlay untuk sidebar */
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 104; /* Di bawah sidebar tapi di atas konten */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s cubic-bezier(0.22, 1, 0.36, 1), visibility 0.4s;
    }
    .sidebar-overlay.open {
        opacity: 1;
        visibility: visible;
    }

    /* -- 4. Komponen & Kartu -- */
    .card {
      background-color: var(--secondary-bg);
      border-radius: 12px;
      padding: 24px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 20px var(--shadow-color);
    }
    .card-header {
      font-weight: 600; font-size: 16px;
      padding-bottom: 12px; margin-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }
    .scrollable-content { overflow-y: auto; max-height: 200px; }
    /* Perbaikan CSS Papan Peringkat */
    .leaderboard-entry {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px solid var(--border-color);
        font-size: 14px;
    }
    .leaderboard-entry:last-child {
        border-bottom: none;
    }
    .leaderboard-entry strong {
        color: var(--text-primary);
    }
    .leaderboard-entry.current-user {
        background-color: rgba(127, 90, 240, 0.1);
        padding: 6px 8px;
        margin: 0 -8px;
        border-radius: 6px;
    }

    /* -- 5. Halaman Spesifik -- */
    /* Landing */
    .landing-content {
      min-height: calc(100vh - var(--header-height) - 48px);
      display: flex; align-items: center; justify-content: center;
      text-align: center;
    }
    .landing-text { max-width: 550px; }
    .landing-text h2 {
      font-size: 48px; font-weight: 800; line-height: 1.2;
    }
    .landing-text .highlight { color: var(--accent); }
    .landing-text p { font-size: 18px; color: var(--text-secondary); margin: 16px 0 32px; }
    .landing-input-group { display: flex; gap: 8px; flex-direction: column; align-items: center; }
    .landing-input-group input { text-align: center; }
    .landing-input-group button { width: 100%; max-width: 300px; }


    /* Beranda */
    .home-hero { text-align: center; padding: 48px 0; }
    .home-hero h3 { font-size: 32px; font-weight: 700; margin-bottom: 8px; }
    .home-hero p { color: var(--text-secondary); max-width: 600px; margin: auto; }
    .founder-section { margin-top: 48px; text-align: center; }
    .founder-section h3 { font-size: 24px; margin-bottom: 24px; }
    .founder-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; max-width: 600px; margin: auto; }
    .founder-card { position: relative; }
    .founder-photo {
      width: 150px; height: 150px; margin: auto;
      border-radius: 50%; overflow: hidden;
      border: 4px solid var(--secondary-bg);
      box-shadow: 0 0 0 2px var(--accent);
      position: relative; z-index: 2;
    }
    .founder-photo img { width: 100%; height: 100%; object-fit: cover; }
    .founder-shape {
      width: 150px; height: 150px; background: var(--accent);
      border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%) rotate(15deg);
      opacity: 0.2;
      z-index: 1;
    }
    .founder-card h4 { font-size: 18px; margin-top: 16px; }
    .founder-card p { color: var(--text-secondary); font-size: 14px; }

    /* Pemilihan Topik/Mapel */
    h2 { font-size: 28px; font-weight: 700; }
    .selection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 24px;
    }
    .selection-card {
        background-color: var(--secondary-bg);
        padding: 24px; border-radius: 12px;
        border: 1px solid var(--border-color);
        text-decoration: none; color: var(--text-primary);
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .selection-card:hover {
        transform: translateY(-5px) scale(1.02);
        border-color: var(--accent);
        box-shadow: 0 8px 30px rgba(127, 90, 240, 0.2);
    }
    .selection-card h4 { font-size: 18px; margin-bottom: 4px; }
    .selection-card p { font-size: 14px; color: var(--text-secondary); }

    /* Perbaikan Video & Kuis */
    .video-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* Aspect Ratio 16:9 */
        background-color: #000;
        border-radius: 8px;
        overflow: hidden;
    }
    .video-container video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    
    @keyframes slideInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .question-text { animation: slideInUp 0.4s ease-out; }
    .options { animation: slideInUp 0.4s ease-out 0.1s; animation-fill-mode: backwards; }
    .option.correct { background-color: var(--green) !important; color: white !important; border-color: var(--green) !important; }
    .option.wrong { background-color: var(--red) !important; color: white !important; border-color: var(--red) !important; animation: shake 0.5s; }
    @keyframes shake { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }

    /* Halaman AI Mentor */
    .mentor-page-container {
        height: calc(100vh - var(--header-height) - 48px);
        display: flex;
        flex-direction: column;
        max-width: 800px;
        margin: auto;
    }
    .mentor-log-full {
        flex-grow: 1;
        overflow-y: auto;
        padding: 16px;
        background: var(--primary-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 16px;
    }
    .msg { padding: 10px 14px; border-radius: 12px; margin-bottom: 10px; max-width: 80%; line-height: 1.5; }
    .msg.ai { background: var(--secondary-bg); align-self: flex-start; }
    .msg.user { background: var(--accent); color: white; align-self: flex-end; }
    .mentor-input-full { display: flex; gap: 8px; }
    
    /* Halaman Feedback */
    .feedback-container { max-width: 600px; margin: 32px auto; display: flex; flex-direction: column; gap: 24px; }
    .feedback-wrapper { text-align: center; gap: 16px; }
    .star-rating {
        display: flex; justify-content: center; gap: 8px; font-size: 32px; cursor: pointer;
    }
    .star-rating .star { color: var(--text-secondary); transition: all 0.2s; }
    .star-rating .star:hover, .star-rating .star.selected { color: var(--yellow); transform: scale(1.15); }

    /* -- 6. Tombol & Input -- */
    .btn {
      background: var(--secondary-bg); border: 1px solid var(--border-color);
      padding: 10px 16px; border-radius: 8px; cursor: pointer;
      color: var(--text-primary); font-weight: 500;
      font-family: inherit; font-size: 14px; text-decoration: none;
      transition: all 0.2s ease;
    }
    .btn:hover { border-color: var(--accent); color: var(--accent); }
    .accent-btn { background: var(--accent); color: white; border-color: var(--accent); }
    .accent-btn:hover { background: var(--accent-secondary); border-color: var(--accent-secondary); color: white; }
    .animated-btn { position: relative; overflow: hidden; z-index: 1; }
    .animated-btn span { position: relative; z-index: 2; }
    .animated-btn::after {
        content: ''; position: absolute; top: 50%; left: 50%;
        width: 5px; height: 5px; background: rgba(255,255,255,0.8);
        opacity: 0; border-radius: 100%;
        transform: scale(1, 1) translate(-50%, -50%);
        transform-origin: 50% 50%;
    }
    .animated-btn:active::after { transition: all 0s; opacity: 1; transform: scale(50, 50) translate(-50%, -50%); }
    button:active, .selection-card:active { transform: translateY(1px) scale(0.98); }

    input, textarea {
      width: 100%; padding: 12px 16px; border-radius: 8px;
      border: 1px solid var(--border-color); background: var(--primary-bg);
      color: var(--text-primary); font-size: 14px; font-family: inherit;
    }
    input:focus, textarea:focus { outline: 2px solid var(--accent); border-color: transparent; }

    /* -- 7. Notifikasi -- */
    .notification {
        position: fixed; top: calc(var(--header-height) + 16px);
        left: 50%; transform: translateX(-50%) translateY(-100px);
        background-color: var(--accent); color: white; padding: 12px 24px;
        border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        z-index: 200; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .notification.show { transform: translateX(-50%) translateY(0); }

    /* -- 8. Desain Responsif Sempurna -- */
    @media (max-width: 900px) {
      .container-app { grid-template-columns: 1fr; }
      .sidebar { order: -1; }
    }
    @media (max-width: 768px) {
      .page { padding: 16px; }
      .app-header { padding: 0 16px; }
      .landing-text h2 { font-size: 36px; } /* Ukuran font lebih kecil di HP */
      .landing-text p { font-size: 16px; }
      .home-hero h3 { font-size: 28px; }
      .founder-grid { grid-template-columns: 1fr; }
      .selection-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 480px) {
        .landing-text h2 { font-size: 32px; }
        .card { padding: 16px; }
        .btn { padding: 12px 14px; font-size: 14px; }
        h2 { font-size: 24px; }
    }

    /* PERBAIKAN: Terapkan 'push' HANYA di mode PC/laptop (di atas 900px) */
    @media (min-width: 901px) {
      .sidebar-is-open .app-header,
      .sidebar-is-open .page-container {
        /* Lebar sidebar adalah 280px (sesuai var --sidebar-width) */
        padding-left: var(--sidebar-width); 
      }
    }
  </style>
</head>
<body>
  
  <!-- 1. Landing Screen / Splash Screen -->
  <div id="splashScreen" class="splash-screen">
    <div class="splash-logo">
      <svg class="header-logo" width="48" height="48" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 80V20L60 20C76.5685 20 90 33.4315 90 50C90 66.5685 76.5685 80 60 80H20Z" fill="#7F5AF0" fill-opacity="0.5"></path><path d="M20 70V30H55C66.0457 30 75 38.9543 75 50C75 61.0457 66.0457 70 55 70H20Z" fill="#7F5AF0"></path></svg>
      <h1>BARBAR</h1>
    </div>
  </div>

  <div id="notification" class="notification"></div>
  <div class="overlay" id="completionOverlay"></div>
  <!-- 2. Overlay untuk menutup sidebar -->
  <div id="sidebarOverlay" class="sidebar-overlay"></div>

  <header class="app-header">
    <div class="header-content">
      <div class="header-left">
        <button id="hamburgerBtn" class="hamburger-btn">
          <span></span><span></span><span></span>
        </button>
        <div class="header-title-group">
          <svg class="header-logo" width="32" height="32" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 80V20L60 20C76.5685 20 90 33.4315 90 50C90 66.5685 76.5685 80 60 80H20Z" fill="#7F5AF0" fill-opacity="0.5"></path><path d="M20 70V30H55C66.0457 30 75 38.9543 75 50C75 61.0457 66.0457 70 55 70H20Z" fill="#7F5AF0"></path></svg>
          <h1>BARBAR</h1>
        </div>
      </div>
    </div>
  </header>

  <!-- 4. Sidebar dengan Menu Baru -->
  <nav id="sidebar" class="sidebar-nav">
    <div id="welcomeUser" class="welcome-user" style="display: none;">
      Halo, <strong id="userNameDisplay"></strong>!
    </div>
    <a href="#home" class="nav-link" data-page="homePage">üè† Beranda</a>
    <a href="#belajar" class="nav-link" data-page="subjectSelectionPage">üìö Mulai Belajar</a>
    <a href="#mentor" class="nav-link" data-page="aiMentorPage">ü§ñ AI Mentor</a>
    <a href="https://udinndinn49-debug.github.io/contoh/" target="_blank" class="nav-link">üí¨ Forum Diskusi</a>
    <a href="#feedback" class="nav-link" data-page="feedbackPage">‚≠ê Beri Penilaian</a>
    <a href="#fitur" id="fiturTambahanBtn" class="nav-link">‚ú® Fitur Tambahan</a>
  </nav>

  <div id="pageContainer" class="page-container">
    <div id="landingPage" class="page active">
      <div class="landing-content">
        <div class="landing-text">
          <h2>Selamat Datang di <span class="highlight">BARBAR</span></h2>
          <p>Platform microlearning revolusioner yang membantumu menguasai materi sulit hanya dalam 5 menit. Siap naik level?</p>
          <div class="landing-input-group">
            <input id="userNameInput" type="text" placeholder="Ketik nama Anda untuk memulai..." />
            <button id="startAppBtn" class="btn accent-btn animated-btn"><span>Mulai Petualangan</span></button>
          </div>
        </div>
      </div>
    </div>

    <div id="homePage" class="page">
      <div class="home-hero">
        <h3>Visi & Misi Kami</h3>
        <p>Mendemokratisasi pendidikan berkualitas tinggi melalui teknologi, menjadikannya cepat, mudah diakses, dan menyenangkan bagi setiap pelajar di Indonesia.</p>
      </div>
      <div class="founder-section">
        <h3>Tim Pendiri</h3>
        <div class="founder-grid">
          <div class="founder-card"><div class="founder-photo"><img src="https://placehold.co/200x200/1B1B2B/FFFFFE?text=ZF" alt="Foto Zulfa Fahmiy"></div><div class="founder-shape"></div><h4>Zulfa Fahmiy</h4><p>Chief Executive Officer</p></div>
          <div class="founder-card"><div class="founder-photo"><img src="https://placehold.co/200x200/1B1B2B/FFFFFE?text=PR" alt="Foto Prabu Revolusi"></div><div class="founder-shape"></div><h4>Prabu Revolusi</h4><p>Chief Technology Officer</p></div>
        </div>
      </div>
    </div>
    
    <div id="subjectSelectionPage" class="page">
        <h2>Pilih Mata Pelajaran</h2>
        <p class="page-subtitle">Pilih salah satu mata pelajaran untuk melihat topik yang tersedia.</p>
        <div id="subjectGrid" class="selection-grid"></div>
    </div>

    <div id="topicSelectionPage" class="page">
        <button id="backToSubjectsBtn" class="btn back-btn">‚Üê Kembali ke Mata Pelajaran</button>
        <h2 id="topicSelectionTitle">Pilih Topik</h2>
        <p class="page-subtitle">Topik dirancang untuk dipelajari dalam 5 menit.</p>
        <div id="topicGrid" class="selection-grid"></div>
    </div>

    <div id="appPage" class="page">
      <div class="container-app">
        <main class="left">
          <!-- 2. Perbaikan Kolom Video -->
          <div class="card video-card">
             <div class="video-container">
                <video id="topicVideo" controls preload="metadata"><source src="" type="video/mp4"></video>
            </div>
            <div class="video-info-wrapper">
              <div class="topic-details">
                <h3 id="topicTitle">-</h3>
                <p class="small">Timer sesi: <span class="timer" id="sessTimer">05:00</span></p>
              </div>
              <div class="topic-controls">
                  <div class="progress-line"><i id="progBar"></i></div>
                  <div class="controls">
                    <button class="btn" id="startSession">Mulai Sesi</button>
                  </div>
              </div>
            </div>
          </div>
          <!-- 2. Perbaikan Tampilan Kuis dengan Animasi -->
          <div class="card quiz" id="quizArea" style="display:none">
            <div id="quizHeader">
              <h4>Kuis Singkat</h4>
              <p class="small">Soal tersisa: <span id="remainingQ">0</span></p>
            </div>
            <div id="questionWrap"></div>
            <div class="quiz-controls">
              <button class="btn" id="endSession" style="display:none">Akhiri Sesi</button>
            </div>
          </div>
        </main>
        <aside class="sidebar">
          <div class="card">
            <div class="card-header">Statistik</div>
            <div class="stats-grid">
              <div><p class="small">Topik Selesai</p><strong id="doneTopics">0</strong></div>
              <div><p class="small">Total Poin</p><strong id="totalPoints">0</strong></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">üèÜ Papan Peringkat</div>
            <div id="leaderboard" class="scrollable-content"></div>
          </div>
        </aside>
      </div>
    </div>
    
    <!-- 5. Halaman AI Mentor Terpisah -->
    <div id="aiMentorPage" class="page">
        <h2>AI Mentor</h2>
        <p class="page-subtitle">Punya pertanyaan? Tanyakan pada mentor AI kami. Setiap penggunaan akan mengurangi 20 poin.</p>
        <div class="mentor-page-container card">
            <div id="mentorLog" class="mentor-log-full">
              <div class="msg ai">Halo! Saya adalah mentor AI Anda. Tanyakan apa saja terkait pelajaran hari ini.</div>
            </div>
            <div class="mentor-input-full">
              <input id="mentorInput" type="text" placeholder="Tanya Mentor..." />
              <button class="btn accent-btn" id="sendMentor">Kirim</button>
            </div>
        </div>
    </div>

    <div id="feedbackPage" class="page">
      <div class="feedback-container">
        <div class="card feedback-wrapper">
          <h3>Beri Penilaian Anda</h3>
          <p class="small">Bagaimana pengalaman belajar Anda hari ini?</p>
          <div class="star-rating" id="starRating">
              <span class="star" data-value="1">‚òÜ</span><span class="star" data-value="2">‚òÜ</span><span class="star" data-value="3">‚òÜ</span><span class="star" data-value="4">‚òÜ</span><span class="star" data-value="5">‚òÜ</span>
          </div>
          <textarea id="feedbackText" placeholder="Ketik saran atau masukan Anda di sini..."></textarea>
          <button id="submitFeedback" class="btn accent-btn animated-btn"><span>Kirim Feedback</span></button>
          <p id="feedbackThanks" class="small" style="display:none;">Terima kasih atas masukan Anda!</p>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Bagian JavaScript dimulai di sini -->
  <script>
    /* =========================
      Aplikasi BelajarBareng V4
      Dengan Peningkatan UX/UI
    ========================= */

    // --- KONFIGURASI SUPABASE ---
    const SUPABASE_URL = 'https://rgntufyuatlkikwuyrxx.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnbnR1Znl1YXRsa2lrd3V5cnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjI0OTc0MDQsImV4cCI6MjAzODA3MzQwNH0.zMvL-p7D48o6v22815X-7ANf5bC426_g3Gj82yqM1-U';
    // 3. Flag untuk AI Mentor
    const AI_MENTOR_LIVE = false; // Setel ke true jika sudah terhubung ke AI

    let supabase = null;
    try {
      if (SUPABASE_URL && SUPABASE_ANON_KEY && window.supabase) {
          supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      }
    } catch (e) {
      console.error("Supabase client could not be initialized.", e);
    }

    // --- 4. DATA TOPIK DAN SOAL (DIPERBANYAK) ---
    const SUBJECTS_DATA = {
      "Biologi": [
        { id: "b1", title: "Sistem Pencernaan", video: "https://res.cloudinary.com/dgzufaone/video/upload/v1760703550/Belajar_IPA_Sistem_Pencernaan_Manusia_SiapNaikLevel_fnur0d.mp4", description: "Video: organ & proses pencernaan (‚â§3 menit).", questions: [
          { id: "b1q1", q: "Proses memecah makanan secara kimiawi pertama kali terjadi di?", opts:["Lambung","Mulut","Usus Halus"], a:1 },
          { id: "b1q2", q: "Organ yang menyerap sebagian besar nutrisi adalah?", opts:["Usus Besar","Usus Halus","Lambung"], a:1 },
          { id: "b1q3", q: "Enzim yang memulai pencernaan karbohidrat di mulut adalah?", opts:["Lipase","Pepsin","Amilase"], a:2 },
          { id: "b1q4", q: "Protein pertama kali dicerna secara kimiawi di organ apa?", opts:["Mulut","Lambung","Usus Halus"], a:1 },
          { id: "b1q5", q: "Cairan empedu diproduksi oleh...", opts:["Pankreas","Hati","Lambung"], a:1 },
          { id: "b1q6", q: "Fungsi utama usus besar adalah...", opts:["Menyerap air","Menyerap nutrisi","Mencerna protein"], a:0 },
          { id: "b1q7", q: "Asam klorida (HCl) terdapat di organ?", opts:["Mulut","Pankreas","Lambung"], a:2 },
          { id: "b1q8", q: "Gerakan meremas-remas makanan di kerongkongan disebut?", opts:["Gerak peristaltik","Gerak reflek","Gerak pasif"], a:0 },
          { id: "b1q9", q: "Organ yang menghubungkan rongga mulut dengan lambung?", opts:["Tenggorokan","Kerongkongan","Usus 12 jari"], a:1 },
          { id: "b1q10", q: "Sisa pencernaan dibuang melalui?", opts:["Ginjal","Anus","Kulit"], a:1 }
        ] },
        { id: "b2", title: "Sirkulasi Darah", video: "https://res.cloudinary.com/dgzufaone/video/upload/v1760709823/barbar/Apa_yang_terjadi_di_dalam_tubuh_saat_darah_mengalir__-_Belajar_IPA_cj8b2r.mp4", description: "Sirkulasi darah ringkas (‚â§3 menit).", questions: [
          { id: "b2q1", q: "Bagian darah yang berperan dalam pembekuan darah?", opts:["Eritrosit","Leukosit","Trombosit"], a:2 },
          { id: "b2q2", q: "Pembuluh yang membawa darah kaya oksigen dari paru-paru ke jantung?", opts:["Vena Kava","Arteri Pulmonalis","Vena Pulmonalis"], a:2 },
          { id: "b2q3", q: "Darah yang kaya CO2 dipompa ke mana oleh bilik kanan?", opts:["Seluruh tubuh","Paru-paru","Hati"], a:1 },
          { id: "b2q4", q: "Sel darah merah disebut juga?", opts:["Eritrosit","Leukosit","Trombosit"], a:0 },
          { id: "b2q5", q: "Fungsi utama sel darah putih adalah?", opts:["Mengangkut O2","Melawan penyakit","Membekukan darah"], a:1 },
          { id: "b2q6", q: "Pembuluh darah terbesar dalam tubuh adalah?", opts:["Aorta","Vena Kava","Kapiler"], a:0 },
          { id: "b2q7", q: "Alat pemompa darah dalam tubuh adalah?", opts:["Paru-paru","Jantung","Ginjal"], a:1 },
          { id: "b2q8", q: "Darah dari seluruh tubuh yang kaya CO2 pertama kali masuk ke...", opts:["Bilik kiri","Serambi kanan","Bilik kanan"], a:1 },
          { id: "b2q9", q: "Peredaran darah kecil adalah dari jantung ke...", opts:["Seluruh tubuh","Paru-paru, lalu kembali ke jantung","Hati, lalu kembali ke jantung"], a:1 },
          { id: "b2q10", q: "Hemoglobin berfungsi untuk mengikat?", opts:["Karbon dioksida","Oksigen","Nutrisi"], a:1 }
        ] }
      ],
      "Matematika": [
        { id: "m1", title: "Konsep Pecahan", video: "https://res.cloudinary.com/dgzufaone/video/upload/v1760751491/barbar/Pecahan_-_Animasi_Matematika_SD_n2roxi.mp4", description: "Apa itu pembilang dan penyebut?", questions: [
          { id: "m1q1", q: "Berapakah hasil dari 1/2 + 1/4?", opts:["2/6","3/4","1/3"], a:1 },
          { id: "m1q2", q: "Angka di bagian bawah pecahan disebut?", opts:["Pembilang","Penyebut","Koefisien"], a:1 },
          { id: "m1q3", q: "Manakah pecahan yang nilainya sama dengan 1?", opts:["5/5","1/5","5/1"], a:0 },
          { id: "m1q4", q: "Hasil dari 3/5 x 1/2 adalah?", opts:["3/10","4/7","3/7"], a:0 },
          { id: "m1q5", q: "Bentuk desimal dari 1/2 adalah?", opts:["0.1","0.2","0.5"], a:2 },
          { id: "m1q6", q: "Manakah pecahan yang lebih besar, 1/3 atau 1/4?", opts:["1/3","1/4","Sama besar"], a:0 },
          { id: "m1q7", q: "Hasil dari 1 - 1/3 adalah?", opts:["1/3","2/3","0"], a:1 },
          { id: "m1q8", q: "Pecahan 2/4 dapat disederhanakan menjadi?", opts:["1/2","1/4","2/2"], a:0 },
          { id: "m1q9", q: "Angka di bagian atas pecahan disebut?", opts:["Pembilang","Penyebut","Hasil"], a:0 },
          { id: "m1q10", q: "Bentuk persen dari 1/4 adalah?", opts:["14%","40%","25%"], a:2 }
        ] },
        { id: "m2", title: "Bangun Datar", video: "https://res.cloudinary.com/dgzufaone/video/upload/v1760751491/barbar/Pecahan_-_Animasi_Matematika_SD_n2roxi.mp4", description: "Mengenal rumus luas dan keliling.", questions: [
          { id: "m2q1", q: "Rumus luas persegi panjang adalah?", opts:["sisi x sisi","panjang x lebar","alas x tinggi / 2"], a:1 },
          { id: "m2q2", q: "Sebuah persegi memiliki sisi 5 cm. Berapa luasnya?", opts:["20 cm¬≤","25 cm¬≤","10 cm¬≤"], a:1 },
          { id: "m2q3", q: "Rumus keliling persegi adalah?", opts:["4 x sisi","sisi x sisi","panjang + lebar"], a:0 },
          { id: "m2q4", q: "Bangun yang memiliki 3 sisi disebut?", opts:["Persegi","Segitiga","Lingkaran"], a:1 },
          { id: "m2q5", q: "Rumus luas segitiga adalah?", opts:["alas x tinggi","(alas x tinggi) / 2","sisi + sisi + sisi"], a:1 },
          { id: "m2q6", q: "Persegi panjang memiliki lebar 4 cm dan panjang 6 cm. Berapa kelilingnya?", opts:["20 cm","24 cm","10 cm"], a:0 },
          { id: "m2q7", q: "Bangun datar yang semua sisinya sama panjang?", opts:["Persegi","Persegi Panjang","Jajar Genjang"], a:0 },
          { id: "m2q8", q: "Berapa jumlah sudut dalam sebuah segitiga?", opts:["90¬∞","360¬∞","180¬∞"], a:2 },
          { id: "m2q9", q: "Rumus keliling lingkaran adalah?", opts:["œÄ x r¬≤","2 x œÄ x r","œÄ x d¬≤"], a:1 },
          { id: "m2q10", q: "Segitiga yang semua sisinya berbeda panjang disebut?", opts:["Segitiga sama sisi","Segitiga sama kaki","Segitiga sembarang"], a:2 }
        ] }
      ],
      "Ekonomi": [
        { id: "e1", title: "Permintaan & Penawaran", video: "https://res.cloudinary.com/dgzufaone/video/upload/v1760750374/introduction-to-supply-and-demand_PwrjcZaP_x6tsu1.mp4", description: "Mengenal kurva D dan S (‚â§3 menit).", questions: [
          { id: "e1q1", q: "Jika harga barang naik, maka jumlah barang yang diminta cenderung...", opts:["Naik","Tetap","Turun"], a:2 },
          { id: "e1q2", q: "Titik pertemuan kurva permintaan dan penawaran disebut?", opts:["Harga Maksimum","Keseimbangan Pasar","Titik Impas"], a:1 },
          { id: "e1q3", q: "Hukum penawaran menyatakan, jika harga naik, maka jumlah yang ditawarkan akan...", opts:["Naik","Turun","Tetap"], a:0 },
          { id: "e1q4", q: "Barang pengganti disebut juga barang...", opts:["Komplementer","Substitusi","Inferior"], a:1 },
          { id: "e1q5", q: "Contoh barang komplementer?", opts:["Kopi dan Teh","Beras dan Jagung","Mobil dan Bensin"], a:2 },
          { id: "e1q6", q: "Pasar di mana hanya ada satu penjual disebut?", opts:["Monopoli","Oligopoli","Monopsoni"], a:0 },
          { id: "e1q7", q: "Jika pendapatan masyarakat naik, permintaan barang normal akan...", opts:["Naik","Turun","Tetap"], a:0 },
          { id: "e1q8", q: "Kurva permintaan memiliki kemiringan (slope)...", opts:["Positif","Negatif","Nol"], a:1 },
          { id: "e1q9", q: "Pergeseran kurva permintaan ke kanan berarti permintaan...", opts:["Bertambah","Berkurang","Tidak berubah"], a:0 },
          { id: "e1q10", q: "Biaya produksi adalah faktor yang mempengaruhi...", opts:["Permintaan","Penawaran","Keseimbangan"], a:1 }
        ] }
      ]
    };

    // --- STATE APLIKASI ---
    const appState = {
      subjects: SUBJECTS_DATA,
      currentSubject: null,
      currentTopicIndex: null,
      sessionSeconds: 300,
      timerHandle: null,
      remainingSeconds: 300,
      quizQueue: [],
      points: 0,
      completed: {},
      userName: '',
    };

    function loadState(){
      try {
        const raw = localStorage.getItem('bb_state_v3');
        if(raw){
          const s = JSON.parse(raw);
          if(s.points) appState.points = s.points;
          if(s.completed) appState.completed = s.completed;
        }
        appState.userName = localStorage.getItem('bb_username_v3') || '';
      } catch(e) { console.warn("Gagal memuat state:", e); }
    }

    function saveState(){
      const toSave = { points: appState.points, completed: appState.completed };
      localStorage.setItem('bb_state_v3', JSON.stringify(toSave));
    }

    // --- KUMPULAN ELEMEN UI ---
    const ui = {
        pageContainer: document.getElementById('pageContainer'),
        notification: document.getElementById('notification'),
        splashScreen: document.getElementById('splashScreen'),
        subjectsWrap: document.getElementById('subjectGrid'),
        topicsWrap: document.getElementById('topicGrid'),
        topicTitle: document.getElementById('topicTitle'),
        topicVideo: document.getElementById('topicVideo'),
        sessTimer: document.getElementById('sessTimer'),
        startSessionBtn: document.getElementById('startSession'),
        progBar: document.getElementById('progBar'),
        quizArea: document.getElementById('quizArea'),
        questionWrap: document.getElementById('questionWrap'),
        remainingQ: document.getElementById('remainingQ'),
        endSessionBtn: document.getElementById('endSession'),
        doneTopicsEl: document.getElementById('doneTopics'),
        totalPointsEl: document.getElementById('totalPoints'),
        mentorLog: document.getElementById('mentorLog'),
        mentorInput: document.getElementById('mentorInput'),
        sendMentorBtn: document.getElementById('sendMentor'),
        completionOverlay: document.getElementById('completionOverlay'),
        hamburgerBtn: document.getElementById('hamburgerBtn'),
        sidebar: document.getElementById('sidebar'),
        sidebarOverlay: document.getElementById('sidebarOverlay'), // 2. Elemen overlay
        navLinks: document.querySelectorAll('.nav-link'),
        pages: document.querySelectorAll('.page'),
        userNameInput: document.getElementById('userNameInput'),
        startAppBtn: document.getElementById('startAppBtn'),
        welcomeUser: document.getElementById('welcomeUser'),
        userNameDisplay: document.getElementById('userNameDisplay'),
        starRatingContainer: document.getElementById('starRating'),
        feedbackText: document.getElementById('feedbackText'),
        submitFeedbackBtn: document.getElementById('submitFeedback'),
        feedbackThanks: document.getElementById('feedbackThanks'),
        fiturTambahanBtn: document.getElementById('fiturTambahanBtn'),
        backToSubjectsBtn: document.getElementById('backToSubjectsBtn'),
        topicSelectionTitle: document.getElementById('topicSelectionTitle'),
    };

    // --- MANAJEMEN HALAMAN & NAVIGASI ---

    // PERBAIKAN: Fungsi helper baru untuk mengontrol status sidebar
    function setSidebarOpen(isOpen) {
        ui.sidebar.classList.toggle('open', isOpen);
        ui.sidebarOverlay.classList.toggle('open', isOpen);
        // Selalu tambahkan/hapus kelas ini, CSS media query yang akan menanganinya
        document.body.classList.toggle('sidebar-is-open', isOpen);
    }

    function showPage(pageId) {
        ui.pages.forEach(p => p.classList.remove('active'));
        document.getElementById(pageId)?.classList.add('active');

        ui.navLinks.forEach(link => {
            link.classList.toggle('active', link.dataset.page === pageId);
        });
        
        // PERBAIKAN: Gunakan helper untuk menutup sidebar
        setSidebarOpen(false);
    }

    function showNotification(message) {
        ui.notification.textContent = message;
        ui.notification.classList.add('show');
        setTimeout(() => {
            ui.notification.classList.remove('show');
        }, 2000); // 2. Durasi notifikasi diubah menjadi 2 detik
    }

    // --- INISIALISASI APLIKASI ---
    function init(){
        // Tampilkan splash screen selama 2 detik
        setTimeout(() => {
            ui.splashScreen.classList.add('hidden');
            loadState();
            
            if (appState.userName) {
                ui.userNameDisplay.textContent = appState.userName;
                ui.welcomeUser.style.display = 'block';
                showPage('homePage');
            } else {
                showPage('landingPage');
            }
        }, 1500);

        renderLeaderboard();
        setupEventListeners();
    }

    // --- RENDER KONTEN DINAMIS ---
    function renderSubjectSelection() {
        ui.subjectsWrap.innerHTML = '';
        Object.keys(appState.subjects).forEach(subjectName => {
            const card = document.createElement('a');
            card.href = "#";
            card.className = 'selection-card';
            card.innerHTML = `<h4>${subjectName}</h4><p>${appState.subjects[subjectName].length} topik tersedia</p>`;
            card.onclick = (e) => {
                e.preventDefault();
                appState.currentSubject = subjectName;
                renderTopicSelection(subjectName);
                showPage('topicSelectionPage');
            };
            ui.subjectsWrap.appendChild(card);
        });
    }

    function renderTopicSelection(subjectName) {
        ui.topicSelectionTitle.textContent = `Pilih Topik - ${subjectName}`;
        ui.topicsWrap.innerHTML = '';
        const topics = appState.subjects[subjectName];
        topics.forEach((topic, index) => {
            const card = document.createElement('a');
            card.href = "#";
            card.className = 'selection-card';
            card.innerHTML = `<h4>${topic.title}</h4><p>${topic.description}</p>`;
            card.onclick = (e) => {
                e.preventDefault();
                appState.currentTopicIndex = index;
                loadTopic(index);
                showPage('appPage');
            };
            ui.topicsWrap.appendChild(card);
        });
    }

    function loadTopic(index){
      const t = currentTopic();
      ui.topicTitle.textContent = t.title;
      const videoSource = ui.topicVideo.querySelector('source');
      if (videoSource) {
        videoSource.src = t.video;
        ui.topicVideo.load();
      }
      appState.quizQueue = shuffleArray(t.questions.map(q=> ({...q, attempts:0}) ));
      renderQuiz();
      updateProgBar();
      updateStats();
    }

    // --- LOGIKA SESI BELAJAR & KUIS ---
    function formatTime(sec){
      const m = Math.floor(sec/60).toString().padStart(2,'0');
      const s = (sec%60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }

    function startSession(){
      if(appState.timerHandle) clearInterval(appState.timerHandle);
      
      appState.remainingSeconds = appState.sessionSeconds;
      ui.sessTimer.textContent = formatTime(appState.remainingSeconds);
      appState.timerHandle = setInterval(()=>{
        appState.remainingSeconds--;
        ui.sessTimer.textContent = formatTime(appState.remainingSeconds);
        if(appState.remainingSeconds <= 0){
          clearInterval(appState.timerHandle);
          endSession(true);
        }
      }, 1000);
      ui.topicVideo.play().catch(()=>{});
      ui.quizArea.style.display = 'block';
    }

    function renderQuiz(){
      ui.questionWrap.innerHTML = '';
      if(!appState.quizQueue || appState.quizQueue.length === 0){
        ui.questionWrap.innerHTML = '<p class="small">Tidak ada soal untuk topik ini.</p>';
        ui.remainingQ.textContent = 0;
        return;
      }
      const q = appState.quizQueue[0];
      ui.questionWrap.innerHTML = `<p class="question-text">${q.q}</p>`;
      const optsWrap = document.createElement('div');
      optsWrap.className = 'options';
      q.opts.forEach((o, i)=>{
        const op = document.createElement('button');
        op.className = 'option animated-btn btn'; // Tambahkan class btn agar styling konsisten
        op.innerHTML = `<span>${o}</span>`;
        op.onclick = ()=> handleAnswer(q, i, op);
        optsWrap.appendChild(op);
      });
      ui.questionWrap.appendChild(optsWrap);
      ui.remainingQ.textContent = appState.quizQueue.length;
      ui.endSessionBtn.style.display = 'none';
    }

    function handleAnswer(question, selectedIndex, elNode){
      const correct = (selectedIndex === question.a);
      elNode.parentElement.querySelectorAll('.option').forEach(node=> node.disabled = true);

      const correctAnswerNode = elNode.parentElement.querySelectorAll('.option')[question.a];
      correctAnswerNode.classList.add('correct');
      
      const isAlreadyCompleted = appState.completed[currentTopic().id];

      if(correct){
        if (!isAlreadyCompleted) appState.points += 10;
        appState.quizQueue.shift();
      } else {
        elNode.classList.add('wrong');
        appState.quizQueue.push(appState.quizQueue.shift()); // Put back to the end
      }
      
      setTimeout(()=>{
        if(appState.quizQueue.length > 0){
          renderQuiz();
        } else {
          ui.questionWrap.innerHTML = '<p class="small" style="text-align:center;">üéâ<br/><b>Selamat!</b><br/>Semua soal selesai.</p>';
          ui.endSessionBtn.style.display = 'block';
        }
        updateStats();
      }, 1200);
    }

    function endSession(timedOut=false){
      if(appState.timerHandle) clearInterval(appState.timerHandle);
      
      const t = currentTopic();
      const isAlreadyCompleted = appState.completed[t.id];
      
      if (!isAlreadyCompleted) {
          appState.points += 20; // Bonus
          markCompleted(true);
          postMentorMessage(`Bagus! Kamu dapat bonus 20 poin untuk topik "${t.title}".`, 'ai');
          if(window.confetti) confetti();
      } else {
          postMentorMessage(`Kamu menyelesaikan topik "${t.title}" lagi! Kerja bagus!`, 'ai');
      }
      
      updateStats();
      ui.quizArea.style.display = 'none';
    }

    function markCompleted(success){
      if(success) appState.completed[currentTopic().id] = true;
      updateStats();
    }

    function shuffleArray(arr){
      for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr;
    }
    function currentTopic(){ return appState.subjects[appState.currentSubject][appState.currentTopicIndex]; }

    function updateProgBar(){
      const topic = currentTopic();
      if (!topic) return;
      const done = appState.completed[topic.id] ? 100 : 0;
      ui.progBar.style.width = done + '%';
    }

    function updateStats(){
      saveState();
      ui.doneTopicsEl.textContent = Object.values(appState.completed).filter(v=>v).length;
      ui.totalPointsEl.textContent = appState.points;
      updateProgBar();
      updateUserScore();
    }

    // --- PAPAN PERINGKAT & AI MENTOR ---
    async function renderLeaderboard() {
        const boardEl = document.getElementById('leaderboard');
        if (!supabase) return;
        boardEl.innerHTML = '<p class="small">Memuat data...</p>';

        const { data, error } = await supabase
            .from('leaderboard').select('name, score').order('score', { ascending: false }).limit(25);

        if (error) { boardEl.innerHTML = '<p class="small">Gagal memuat data.</p>'; return; }
        
        boardEl.innerHTML = '';
        const emojis = ['ü•á', 'ü•à', 'ü•â'];
        data.forEach((entry, idx) => {
            const div = document.createElement('div');
            // Pastikan 'name' ada, jika tidak, gunakan 'Anonim'
            const entryName = entry.name ? entry.name : 'Anonim';
            div.className = `leaderboard-entry small ${entryName === appState.userName ? 'current-user' : ''}`;
            div.innerHTML = `<span>${emojis[idx] || `${idx + 1}.`} <strong>${entryName}</strong></span> <span>${entry.score} poin</span>`;
            boardEl.appendChild(div);
        });
    }

    async function updateUserScore() {
        if (!appState.userName || !supabase) return;
        await supabase.from('leaderboard').upsert({ name: appState.userName, score: appState.points }, { onConflict: 'name' });
        renderLeaderboard();
    }

    function postMentorMessage(text, who='ai'){ 
        const div = document.createElement('div');
        div.className = 'msg ' + (who==='ai' ? 'ai' : 'user');
        div.textContent = text;
        ui.mentorLog.appendChild(div);
        ui.mentorLog.scrollTop = ui.mentorLog.scrollHeight;
    }

    // --- EVENT LISTENERS ---
    function setupEventListeners() {
        // PERBAIKAN: Gunakan helper
        ui.hamburgerBtn.addEventListener('click', () => {
            const isOpen = !ui.sidebar.classList.contains('open');
            setSidebarOpen(isOpen);
        });
        
        // PERBAIKAN: Gunakan helper
        ui.sidebarOverlay.addEventListener('click', () => {
            setSidebarOpen(false);
        });
        
        ui.navLinks.forEach(link => {
            if (link.id === 'fiturTambahanBtn') return; 
            link.addEventListener('click', (e) => {
                if (link.target === "_blank") return;
                e.preventDefault();
                const pageId = link.dataset.page;

                if (!appState.userName && pageId !== 'landingPage' && pageId !== 'homePage') {
                    showPage('landingPage');
                    return;
                }
                
                if (pageId === 'subjectSelectionPage') {
                    renderSubjectSelection();
                }
                showPage(pageId); // showPage akan otomatis menutup sidebar
            });
        });

        ui.startAppBtn.addEventListener('click', () => {
          const name = ui.userNameInput.value.trim();
          if (name.length < 3) {
            showNotification("Nama harus diisi minimal 3 karakter.");
            return;
          }
          appState.userName = name;
          localStorage.setItem('bb_username_v3', name);
          ui.userNameDisplay.textContent = name;
          ui.welcomeUser.style.display = 'block';
          showPage('homePage');
          updateStats();
        });

        ui.fiturTambahanBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showNotification("Fitur ini masih dalam tahap pengembangan.");
            setSidebarOpen(false); // Tutup sidebar
        });

        ui.backToSubjectsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderSubjectSelection();
            showPage('subjectSelectionPage');
        });

        ui.startSessionBtn.addEventListener('click', startSession);
        ui.endSessionBtn.addEventListener('click', () => endSession(false));
        
        ui.mentorInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') ui.sendMentorBtn.click(); });
        ui.sendMentorBtn.addEventListener('click', ()=>{
          const v = ui.mentorInput.value.trim();
          if(!v) return;
          postMentorMessage(v, 'user');
          ui.mentorInput.value = '';
          
          // 3. Logika AI Mentor diperbaiki
          if (AI_MENTOR_LIVE) {
              // Blok ini akan berjalan jika AI SUDAH AKTIF
              if(appState.points >= 20) {
                appState.points -= 20;
                showNotification('Bantuan AI digunakan (-20 poin).');
                updateStats();
                
                // TODO: Ganti dengan panggilan API AI (Gemini) yang sebenarnya
                setTimeout(() => {
                    postMentorMessage("Ini adalah jawaban dari AI untuk: '" + v + "'", 'ai');
                }, 1500);

              } else {
                postMentorMessage('Maaf, poin Anda tidak cukup untuk menggunakan AI Mentor.', 'ai');
              }
          } else {
              // Blok ini berjalan jika AI_MENTOR_LIVE = false (sedang maintenance)
              postMentorMessage('Maaf, koneksi ke AI sedang dalam pemeliharaan. Anda tidak akan dikenakan poin.', 'ai');
          }
        });
    }

    // --- Mulai Aplikasi ---
    init();
  </script>
</body>
</html>
